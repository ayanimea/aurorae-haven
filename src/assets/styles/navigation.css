/**
 * Navigation Styles
 * 
 * Uses design tokens from tokens.css for:
 * - Touch targets: var(--touch-min), var(--touch-comfortable)
 * - Icon sizes: var(--icon-sm), var(--icon-md)
 * - Font sizes: var(--font-xs), var(--font-sm)
 * - Z-index: var(--z-mobile-menu), var(--z-content), var(--z-editor)
 * - Shell padding: var(--shell-padding-narrow), var(--shell-padding-compact), var(--shell-padding-comfortable)
 */

/* Priority 3: Content Density Controls */
/* Default: comfortable (current) */
:root {
  --density-multiplier: 1;
}

/* Compact density */
body.density-compact {
  --density-multiplier: 0.8;
}

/* Cozy density */
body.density-cozy {
  --density-multiplier: 0.9;
}

/* TAB-NAV-02 & TAB-NAV-16: App bar with frosted glass */
.appbar {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  z-index: 20;
  background: rgba(16, 20, 44, 0.3);
  backdrop-filter: var(--blur);
  border-bottom: 1px solid var(--line);
  box-shadow: var(--shadow);
  max-width: 100vw;
  /* Overflow hidden prevents horizontal scrollbar on narrow viewports.
     Compact navigation activates at 769px to ensure all items remain accessible
     without scrolling. Hamburger menu provides full navigation below 768px. */
  overflow: hidden;
}

/* TAB-NAV-01: Three-zone layout */
.appbar .inner {
  max-width: 100%;
  margin: 0 auto;
  padding: 8px 12px;
  display: flex;
  align-items: center;
  gap: 12px;
  justify-content: space-between;
  flex-wrap: nowrap;
}

/* TAB-NAV-04: Left Zone - Logo/Title */
.navbar-left {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 0 12px 0 0;
}

.logo-button {
  background: none;
  border: none;
  padding: 0;
  cursor: pointer;
  display: flex;
  align-items: center;
  transition: transform var(--dur) var(--ease);
}

.logo-button:hover {
  transform: scale(1.05);
}

.logo-button:focus {
  outline: 3px solid var(--mint);
  outline-offset: 4px;
  border-radius: 8px;
}

.logo {
  width: var(--icon-md);
  height: var(--icon-md);
  border-radius: 7px;
  background:
    radial-gradient(
      12px 12px at 40% 40%,
      #74ffe1 0%,
      rgba(116, 255, 225, 0) 60%
    ),
    radial-gradient(
      18px 18px at 70% 70%,
      #7ea6ff 0%,
      rgba(126, 166, 255, 0) 60%
    );
  box-shadow:
    0 0 20px rgba(126, 166, 255, 0.35),
    0 0 14px rgba(134, 245, 224, 0.18) inset;
}

.brand {
  display: flex;
  flex-direction: column;
}

.brand b {
  font-weight: 700;
  letter-spacing: 0.2px;
  color: var(--ink);
  font-size: 1rem;
  white-space: nowrap;
}

/* TAB-NAV-06: Center Zone - Primary Tabs */
.navbar-center {
  flex: 1;
  display: flex;
  justify-content: center;
}

.appnav {
  display: flex;
  gap: 6px;
  align-items: center;
  flex-wrap: nowrap;
  justify-content: center;
}

/* Hide mobile-bottom-tabs on desktop */
.mobile-bottom-tabs {
  display: none;
}

/* TAB-NAV-07: Pill-shaped tab buttons with hover/active states */
/* TAB-LIB-23: Touch targets ≥48×48px for better accessibility */
.nav-tab {
  display: inline-flex;
  gap: 6px;
  align-items: center;
  padding: 6px 10px;
  min-height: var(--touch-comfortable);
  min-width: var(--touch-comfortable);
  border-radius: 20px;
  color: var(--dim);
  background: transparent;
  border: 1px solid transparent;
  text-decoration: none;
  font-size: 0.9rem;
  transition: all var(--dur) var(--ease);
  cursor: pointer;
  white-space: nowrap;
}

/* TAB-NAV-07 & TAB-NAV-17: Active state with accent background */
.nav-tab.active {
  background: var(--mint);
  color: var(--ink);
  font-weight: 700;
  border-color: var(--mint);
}

/* TAB-NAV-07: Hover state with underline and semi-transparent background */
.nav-tab:hover:not(.active) {
  background: rgba(140, 150, 210, 0.12);
  color: var(--ink);
  text-decoration: underline;
  text-decoration-color: var(--mint);
  text-underline-offset: 4px;
}

/* TAB-NAV-18: Focus outline with ≥3px visible outline */
.nav-tab:focus {
  outline: 3px solid var(--mint);
  outline-offset: 2px;
}

.nav-tab .icon {
  width: 16px;
  height: 16px;
  stroke: currentColor;
  fill: none;
  stroke-width: 2;
  stroke-linecap: round;
  stroke-linejoin: round;
}

/* TAB-NAV-10: Right Zone - Global Actions */
.navbar-right {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 0 0 0 12px;
}

/* TAB-NAV-19: Icon buttons with hover states */
/* TAB-LIB-23: Touch targets ≥48×48px for better accessibility */
.icon-button {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: var(--touch-comfortable);
  height: var(--touch-comfortable);
  background: transparent;
  border: none;
  border-radius: 8px;
  color: var(--ink);
  cursor: pointer;
  transition: all var(--dur) var(--ease);
}

.icon-button:hover {
  background: rgba(140, 150, 210, 0.12);
  color: var(--mint);
}

.icon-button:focus {
  outline: 3px solid var(--mint);
  outline-offset: 2px;
}

.icon-button .icon {
  width: var(--icon-sm);
  height: var(--icon-sm);
  stroke: currentColor;
  fill: none;
  stroke-width: 2;
  stroke-linecap: round;
  stroke-linejoin: round;
}

/* Mobile Settings Button (hidden on desktop) */
.mobile-settings-button {
  display: none;
  align-items: center;
  justify-content: center;
  width: var(--touch-min);
  height: var(--touch-min);
  background: transparent;
  border: none;
  border-radius: 8px;
  color: var(--ink);
  cursor: pointer;
  transition: all var(--dur) var(--ease);
  text-decoration: none;
}

.mobile-settings-button:hover {
  background: rgba(140, 150, 210, 0.12);
  color: var(--mint);
}

.mobile-settings-button:focus {
  outline: 3px solid var(--mint);
  outline-offset: 2px;
}

/* TAB-NAV-13: Hamburger button (hidden on desktop) */
.hamburger-button {
  display: none;
  align-items: center;
  justify-content: center;
  width: var(--touch-min);
  height: var(--touch-min);
  background: transparent;
  border: none;
  border-radius: 8px;
  color: var(--ink);
  cursor: pointer;
  transition: all var(--dur) var(--ease);
}

.hamburger-button:hover {
  background: rgba(140, 150, 210, 0.12);
}

.hamburger-button:focus {
  outline: 3px solid var(--mint);
  outline-offset: 2px;
}

.hamburger-button .icon {
  width: var(--icon-md);
  height: var(--icon-md);
  stroke: currentColor;
  fill: none;
  stroke-width: 2;
  stroke-linecap: round;
  stroke-linejoin: round;
}

/* TAB-NAV-14 & TAB-NAV-15: Mobile hamburger menu */
.mobile-menu-overlay {
  display: none;
}

.mobile-menu {
  display: none;
  position: fixed;
  top: 0;
  left: -56px;
  bottom: 0;
  width: 56px;
  background: rgba(16, 20, 44, 0.98);
  backdrop-filter: var(--blur);
  border-right: 1px solid var(--line);
  box-shadow: var(--shadow);
  z-index: var(--z-mobile-menu);
  overflow-y: auto;
  transition: left 0.3s ease;
}

.mobile-menu.open {
  left: 0;
}

@media (prefers-reduced-motion: reduce) {
  .mobile-menu {
    transition: none;
  }
}

/* More menu for mobile portrait */
.more-menu {
  display: none;
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background: rgba(16, 20, 44, 0.95);
  backdrop-filter: var(--blur);
  border-top: 1px solid var(--line);
  box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.3);
  z-index: 19;
  animation: slideUp 0.2s ease;
}

@keyframes slideUp {
  from {
    transform: translateY(100%);
    opacity: 0;
  }
  to {
    transform: translateY(0);
    opacity: 1;
  }
}

@media (prefers-reduced-motion: reduce) {
  .more-menu {
    animation: none;
  }
}

.more-menu-content {
  display: flex;
  justify-content: space-around;
  padding: 8px;
  gap: 4px;
}

.more-menu-item {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 6px 8px;
  min-width: 60px;
  min-height: var(--touch-comfortable);
  border-radius: 12px;
  color: var(--dim);
  background: transparent;
  border: 1px solid transparent;
  text-decoration: none;
  font-size: var(--font-sm);
  transition: all var(--dur) var(--ease);
  gap: 4px;
}

.more-menu-item.active {
  background: var(--mint);
  color: var(--ink);
  font-weight: 700;
}

.more-menu-item:hover:not(.active) {
  background: rgba(140, 150, 210, 0.12);
  color: var(--ink);
}

.more-menu-item .icon {
  width: var(--icon-sm);
  height: var(--icon-sm);
  stroke: currentColor;
  fill: none;
  stroke-width: 2;
  stroke-linecap: round;
  stroke-linejoin: round;
}

.more-menu-item span {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  max-width: 70px;
}

.mobile-menu-content {
  padding: 72px 4px 16px;
  display: flex;
  flex-direction: column;
  gap: 6px;
}

/* TAB-NAV-14 & TAB-NAV-15: Mobile menu items with ≥48×48px touch targets */
.mobile-menu-item {
  display: flex;
  align-items: center;
  justify-content: center;
  width: var(--touch-comfortable);
  height: var(--touch-comfortable);
  border-radius: 10px;
  color: var(--dim);
  text-decoration: none;
  transition: all var(--dur) var(--ease);
  border-left: 3px solid transparent;
  position: relative;
}

/* TAB-NAV-15: Active tab with accent background and bar */
.mobile-menu-item.active {
  background: rgba(134, 245, 224, 0.15);
  color: var(--mint);
  border-left-color: var(--mint);
}

.mobile-menu-item:hover:not(.active) {
  background: rgba(140, 150, 210, 0.12);
  color: var(--ink);
}

.mobile-menu-item:focus {
  outline: 3px solid var(--mint);
  outline-offset: -3px;
}

.mobile-menu-item .icon {
  width: 22px;
  height: 22px;
  stroke: currentColor;
  fill: none;
  stroke-width: 2;
  stroke-linecap: round;
  stroke-linejoin: round;
}

/* TAB-NAV-13: Responsive behavior for tablet/mobile landscape */
/* Includes phone landscape viewports (812×375, 844×390, 915×412) */
@media (max-width: 968px) and (orientation: landscape) and (max-height: 500px) {
  /* Increase navbar opacity for better readability on mobile */
  .appbar {
    background: rgba(16, 20, 44, 0.85);
    /* Priority 1: Auto-hide header in landscape mode */
    transition:
      transform 0.3s ease,
      left 0.3s ease;
  }

  body.scrolling-down .appbar {
    transform: translateY(-100%);
  }

  body.scrolling-up .appbar,
  body.at-top .appbar {
    transform: translateY(0);
  }

  /* Adjust appbar when menu is open (combined rules) */
  body.mobile-menu-open .appbar {
    left: 56px;
    transform: translateY(0) !important;
  }

  /* Respect user's motion preferences */
  @media (prefers-reduced-motion: reduce) {
    .appbar {
      transition: none;
    }

    body.scrolling-down .appbar {
      transform: none;
    }
  }
}

/* Mobile Portrait ONLY: Navbar at bottom */
/* Use max-height to ensure this only applies to actual mobile devices, not tall desktop windows */
@media (max-width: 968px) and (orientation: portrait) and (max-height: 1024px) {
  .appbar {
    top: auto;
    bottom: 0;
    border-top: 1px solid var(--line);
    border-bottom: none;
    transition: transform 0.3s ease;
    /* Increase opacity for better readability on mobile */
    background: rgba(16, 20, 44, 0.85);
    /* Ensure navbar stays above all page content on mobile portrait */
    z-index: var(--z-mobile-menu);
  }

  /* Auto-hide appbar when scrolling down (Priority 1 adaptation for portrait) */
  body.scrolling-down .appbar {
    transform: translateY(100%);
  }

  body.scrolling-up .appbar,
  body.at-top .appbar {
    transform: translateY(0);
  }

  /* Keep appbar visible when More menu is open (portrait) */
  body.mobile-menu-open .appbar {
    transform: translateY(0) !important;
  }

  /* Respect user's motion preferences in portrait */
  @media (prefers-reduced-motion: reduce) {
    .appbar {
      transition: none;
    }

    body.scrolling-down .appbar {
      transform: none;
    }
  }

  .shell {
    padding-bottom: 70px;
  }

  /* Priority 2: Small mobile optimization - reduce tab bar height */
  @media (max-width: 375px) {
    .shell {
      padding-bottom: 60px;
    }

    .appbar .inner {
      padding: 4px 6px;
    }

    .logo {
      width: 16px;
      height: 16px;
    }

    .nav-tab {
      padding: 3px 5px;
      min-height: var(--touch-min);
      font-size: var(--font-xs);
    }

    .nav-tab .icon {
      width: 18px;
      height: 18px;
    }
  }

  /* Hide hamburger menu on portrait, show bottom tabs instead */
  .hamburger-button {
    display: none;
  }

  .mobile-menu-overlay,
  .mobile-menu {
    display: none;
  }

  /* Hide desktop-only nav elements */
  .navbar-right .icon-button,
  .navbar-right .btn {
    display: none;
  }

  /* Hide mobile settings button (it's now in More menu) */
  .mobile-settings-button {
    display: none !important;
  }

  /* Show logo only */
  .navbar-left {
    padding: 0;
  }

  .brand b {
    display: none;
  }

  .logo {
    width: var(--icon-sm);
    height: var(--icon-sm);
  }

  /* Bottom tab bar navigation */
  .navbar-center {
    display: flex !important;
    flex: 1;
    justify-content: center;
    margin: 0 8px;
  }

  /* Hide desktop tabs */
  .appnav {
    display: none !important;
  }

  /* Show mobile bottom tabs */
  .mobile-bottom-tabs {
    display: flex !important;
    gap: 2px;
    flex-wrap: nowrap;
    justify-content: space-around;
    width: 100%;
    max-width: 100%;
  }

  .nav-tab {
    flex-direction: column;
    padding: 4px 6px;
    min-width: var(--touch-min);
    min-height: var(--touch-min);
    gap: 2px;
    font-size: var(--font-sm);
    border-radius: 12px;
    flex-shrink: 0;
  }

  .nav-tab .icon {
    width: var(--icon-sm);
    height: var(--icon-sm);
  }

  .nav-tab span {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 60px;
  }

  /* More button styling */
  .more-button {
    background: transparent;
    border: 1px solid transparent;
    cursor: pointer;
  }

  .more-button.active {
    background: var(--mint);
    color: var(--ink);
  }

  .appbar .inner {
    padding: 6px 8px;
    gap: 8px;
  }

  /* Show More menu on portrait mobile */
  .more-menu {
    display: block;
  }
}

/* Tablet Landscape: Removed - Let resized desktop windows keep top navigation */
/* Desktop windows should maintain horizontal navigation regardless of resize */
/* Mobile landscape (≤768px) already has sidebar navigation configured above */

/* Small desktop optimization (769px - 1280px) - Compact navigation with labels */
/* Starts at 769px to prevent horizontal overflow at narrower widths */
/* Excludes tablet landscape via separate media query below */
@media (min-width: 769px) and (max-width: 1280px) and (min-height: 769px) {
  .appnav {
    gap: 4px;
  }

  .nav-tab {
    flex-direction: column;
    padding: 8px 6px;
    min-width: var(--touch-comfortable);
    min-height: var(--touch-comfortable);
    gap: 4px;
    border-radius: 12px;
    justify-content: center;
  }

  /* Show text labels below icons */
  .nav-tab span {
    font-size: var(--font-sm);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 70px;
  }

  .nav-tab .icon {
    width: var(--icon-sm);
    height: var(--icon-sm);
  }

  /* Hide brand text, show logo only on smaller screens */
  .brand b {
    display: none;
  }

  /* Increase shell top padding to account for taller navbar with vertical layout */
  .shell {
    padding-top: calc(85px * var(--density-multiplier));
  }
}

/* Tighter spacing for narrower desktop windows (769px - 968px) */
@media (min-width: 769px) and (max-width: 968px) and (min-height: 769px) {
  .appbar .inner {
    gap: 8px;
    padding: 8px 10px;
  }

  .navbar-left {
    gap: 8px;
    padding-right: 8px;
  }

  /* Hide brand text, show logo only */
  .brand b {
    display: none;
  }

  .appnav {
    gap: 3px;
  }

  .nav-tab {
    flex-direction: column;
    padding: 6px 4px;
    min-width: var(--touch-comfortable);
    min-height: var(--touch-comfortable);
    gap: 3px;
    border-radius: 12px;
    justify-content: center;
  }

  /* Show text labels below icons */
  .nav-tab span {
    font-size: var(--font-xs);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 60px;
  }

  .nav-tab .icon {
    width: var(--icon-sm);
    height: var(--icon-sm);
  }

  .navbar-right {
    gap: 6px;
    padding-left: 8px;
  }

  .icon-button {
    width: var(--touch-comfortable);
    height: var(--touch-comfortable);
  }

  .icon-button .icon {
    width: 18px;
    height: 18px;
  }

  /* Increase shell top padding to account for taller navbar with vertical layout */
  .shell {
    padding-top: calc(90px * var(--density-multiplier));
  }
}

/* Tablet Landscape: 769-1100px with limited height - vertical sidebar with hamburger menu */
/* Uses height constraint and aspect ratio to distinguish tablets from desktop windows */
@media (min-width: 769px) and (max-width: 1100px) and (orientation: landscape) and (max-height: 768px) and (max-aspect-ratio: 16/9) {
  /* Hide horizontal navigation */
  .appnav {
    display: none;
  }

  .navbar-center {
    display: none;
  }

  /* Keep .navbar-right visible so Export/Import buttons remain accessible */

  /* Show mobile menu button and settings with 48x48px touch targets */
  .hamburger-button {
    display: flex;
    width: var(--touch-comfortable);
    height: var(--touch-comfortable);
  }

  .mobile-settings-button {
    display: flex;
    width: var(--touch-comfortable);
    height: var(--touch-comfortable);
  }

  /* Show mobile menu */
  .mobile-menu {
    display: block;
  }
}

@media (max-width: 640px) {
  .appbar .inner {
    padding: 10px 14px;
  }

  .navbar-left {
    gap: 8px;
  }

  .brand b {
    font-size: 0.95rem;
  }
}

/* Shell & glass cards - adjusted for fixed navbar */
.shell {
  max-width: min(100%, 1920px);
  width: 100%;
  min-height: calc(100vh - 70px * var(--density-multiplier));
  margin: 0 auto;
  padding: calc(70px * var(--density-multiplier))
    calc(18px * var(--density-multiplier))
    calc(24px * var(--density-multiplier));
  display: flex;
  flex-direction: column;
  transition:
    max-width 0.3s ease,
    padding-left 0.3s ease;
}

/* Adjust shell when mobile menu is open - applies to all orientations
   66px = 56px (menu width) + 10px (spacing gap) */
body.mobile-menu-open .shell {
  padding-left: calc(66px * var(--density-multiplier));
}

/* Shell already uses full width - no special case needed for Brain Dump */

/* Apply density multiplier to card paddings
   Note: Only outer padding is affected by density controls.
   Internal card spacing (gaps, margins) maintains fixed values for consistent readability. */
.card,
.glass-card {
  padding: calc(20px * var(--density-multiplier));
}

/* Apply density to navigation gaps and padding - scoped to landscape to avoid mobile conflicts */
/* Excludes small desktop breakpoints (769-1280px) to prevent overriding compact navigation */
@media (orientation: landscape) and (min-width: 1281px) {
  .appnav {
    gap: calc(6px * var(--density-multiplier));
  }

  .nav-tab {
    padding: calc(6px * var(--density-multiplier))
      calc(10px * var(--density-multiplier));
    gap: calc(6px * var(--density-multiplier));
  }
}

.card {
  background: linear-gradient(180deg, var(--glass-lo), rgba(18, 22, 52, 0.22));
  border: 1px solid var(--line);
  border-radius: 16px;
  box-shadow: var(--shadow);
  backdrop-filter: var(--blur);
  overflow: hidden;
  transition:
    width 0.3s ease,
    max-width 0.3s ease;
}
.card .card-h {
  padding: 10px 14px;
  border-bottom: 1px solid var(--line);
  display: flex;
  align-items: center;
  justify-content: space-between;
}
.card .card-b {
  padding: 14px;
}
.small {
  font-size: 0.92rem;
  color: var(--dim);
}

/* Airy buttons */
/* TAB-LIB-23: Touch targets ≥48×48px for better accessibility */
.btn {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  cursor: pointer;
  color: #fff;
  padding: 9px 12px;
  min-height: var(--touch-comfortable);
  border-radius: 12px;
  border: 1px solid var(--line);
  background: rgba(35, 45, 100, 0.28);
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.28);
  transition:
    transform var(--dur) var(--ease),
    filter var(--dur) var(--ease);
}
.btn:hover {
  filter: brightness(1.06);
  transform: translateY(-1px);
}

/* Icons */
.icon {
  width: 18px;
  height: 18px;
  stroke: var(--ink);
  stroke-width: 2;
  stroke-linecap: round;
  stroke-linejoin: round;
  fill: none;
  opacity: 0.92;
}
